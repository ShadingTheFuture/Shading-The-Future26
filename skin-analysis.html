<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Home | Shading The Future</title>

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">

  <!-- Styles -->
  <link rel="stylesheet" href="style.css">

  <!-- Script -->
  <!-- If your JS is inside /css/, change src to "css/script.js" -->
  <script src="script.js" defer></script>

  <style>
    :root{
      --navy: #7DA3D6;
      --aqua: #92F2D7;
      --aqua-hover: #E1BDF5;
      --pastel: #EBDC76;
      --white: #FFEBAF;
    }
    *{box-sizing:border-box}
    body,html{margin:0;height:100%;font-family:'Poppins',sans-serif;background:var(--pastel);}
    .sidebar{
      position:fixed;top:0;left:-260px;width:260px;height:100%;
      background:var(--navy);padding:18px 16px;transition:left .28s ease;
      z-index:1000;border-top-right-radius:20px;border-bottom-right-radius:20px;
    }
    .sidebar.open{left:0;}
    .logo{text-align:center;margin-bottom:20px;}
    .logo img{width:72px;height:72px;border-radius:50%;display:block;margin:0 auto;}
    .logo h2{color:var(--white);font-size:20px;margin:10px 0 0;}
    .nav-list{list-style:none;padding:0;margin:0;}
    .nav-list li{margin:10px 0;}
    .nav-list a{
      display:block;text-decoration:none;padding:10px 14px;border-radius:8px;
      background:var(--aqua);color:var(--navy);font-weight:700;
    }
    .nav-list a:hover{background:var(--aqua-hover);}
    .close-btn{
      position:absolute;top:8px;right:10px;background:none;border:none;
      font-size:26px;color:var(--white);cursor:pointer;
    }
    .open-btn{
      position:fixed;top:16px;left:16px;z-index:1100;background:none;
      border:none;font-size:28px;cursor:pointer;color:var(--navy);
    }
    .main{
      padding:36px;transition:margin-left .28s ease;min-height:100vh;
    }
    .main.shifted{margin-left:260px;}
    h1{color:#ff91c8;font-size:48px;margin:10px 0 16px;}
    p{font-size:18px;color:#0f2240;}
    @media(max-width:720px){
      .main.shifted{margin-left:0;}
      .sidebar{width:82%;left:-82%;}
      .sidebar.open{left:0;}
    }
  </style>
</head>

<body>
  <!-- open button -->
  <button id="openBtn" class="open-btn" aria-label="Open sidebar" aria-expanded="false" aria-controls="sidebar">‚ò∞</button>

  <!-- sidebar -->
  <aside id="sidebar" class="sidebar" aria-hidden="true">
    <button id="closeBtn" class="close-btn" aria-label="Close sidebar">√ó</button>

    <div class="logo">
      <img src="images/IMG_20250716_220954_451 (1).webp" alt="Logo" onerror="this.style.display='none'">
      <h2>Shading The Future</h2>
    </div>

    <ul class="nav-list">
      <li><a href="index.html" class="active">Home</a></li>
      <li><a href="education-hub.html">Education Hub</a></li>
      <li><a href="skin-analysis.html">Skin Analysis</a></li>
      <li><a href="carbon-footprint.html">Carbon Footprint Tracker</a></li>
      <li><a href="uv-weather.html">UV & Weather Monitor</a></li>
      <li><a href="travel-mode.html">Travel Mode</a></li>
      <li><a href="product-info.html">Product Information</a></li>
      <li><a href="profile.html">Profile</a></li>
      <li><a href="contact.html">Contact Us</a></li>
    </ul>
  </aside>
  <style>
    .sidebar {
      height: 100vh;
      overflow-y: auto;
    }
  </style>
<script>
    document.addEventListener('DOMContentLoaded',()=>{
      const sidebar=document.getElementById('sidebar');
      const openBtn=document.getElementById('openBtn');
      const closeBtn=document.getElementById('closeBtn');
      const main=document.getElementById('main');
      const navLinks=sidebar.querySelectorAll('.nav-list a');

      function openSidebar(){
        sidebar.classList.add('open');
        sidebar.setAttribute('aria-hidden','false');
        openBtn.setAttribute('aria-expanded','true');
        if(window.innerWidth>720)main.classList.add('shifted');
      }
      function closeSidebar(){
        sidebar.classList.remove('open');
        sidebar.setAttribute('aria-hidden','true');
        openBtn.setAttribute('aria-expanded','false');
        main.classList.remove('shifted');
      }

      openBtn.addEventListener('click',()=>{
        sidebar.classList.contains('open')?closeSidebar():openSidebar();
      });
      closeBtn.addEventListener('click',closeSidebar);

      navLinks.forEach(link=>{
        link.addEventListener('click',()=>{
          if(window.innerWidth<=720)closeSidebar();
        });
      });

      document.addEventListener('click',ev=>{
        const inside=sidebar.contains(ev.target)||openBtn.contains(ev.target);
        if(!inside&&sidebar.classList.contains('open')&&window.innerWidth<=720){closeSidebar();}
      });

      document.addEventListener('keydown',ev=>{
        if(ev.key==='Escape'&&sidebar.classList.contains('open')){closeSidebar();openBtn.focus();}
      });

      window.addEventListener('resize',()=>{
        if(window.innerWidth<=720)main.classList.remove('shifted');
      });
    });
  </script>
</body>
</html> 



<!-- üå∏ SKIN ANALYSIS SECTION ‚Äì Fully Styled, Matching Theme -->
<style>
  .skin-section {
    padding: 50px 22px;
    background: #FFF9FD;
    border-radius: 25px;
    margin-top: 55px;
    animation: fadeIn 0.8s ease forwards;
  }

  .skin-title {
    text-align: center;
    font-size: 2.2rem;
    color: #FF90C2;
    font-weight: 800;
  }

  .skin-sub {
    text-align: center;
    max-width: 760px;
    margin: 8px auto 0;
    color: #555;
    font-size: 1.15rem;
  }

  /* Grid layout */
  .skin-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
    gap: 22px;
    margin-top: 35px;
  }

  /* Cards */
  .skin-card {
    padding: 22px;
    border-radius: 22px;
    transition: 0.25s ease;
    animation: fadeUp 0.7s ease forwards;
    opacity: 0;
  }

  .skin-card:nth-child(1){ background:#92F2D7; animation-delay:.1s; }
  .skin-card:nth-child(2){ background:#FFEBAF; animation-delay:.2s; }
  .skin-card:nth-child(3){ background:#FF90C2; color:white; animation-delay:.3s; }

  .skin-card:hover { transform: scale(1.04); box-shadow: 0 8px 20px rgba(0,0,0,0.12); }

  /* Form */
  .skin-form {
    margin-top: 40px;
    background: white;
    padding: 28px;
    border-radius: 20px;
    box-shadow: 0px 8px 30px rgba(0,0,0,0.06);
  }

  .skin-form h3 {
    margin-top:0;
    color: #3BC7C4;
    font-size:1.5rem;
    font-weight:700;
  }

  .skin-field {
    margin-bottom: 18px;
    display:flex;
    flex-direction:column;
  }

  .skin-field label {
    font-weight:600;
    margin-bottom:6px;
    color:#444;
  }

  .skin-field input,
  .skin-field select {
    padding: 12px;
    border: 1px solid #eee;
    border-radius:14px;
    background:#fafafa;
    font-size: 14px;
  }

  .skin-btn {
    background: linear-gradient(90deg, #FF90C2, #3BC7C4);
    color:white;
    padding: 12px 18px;
    border-radius: 14px;
    border: none;
    font-weight:700;
    cursor:pointer;
  }

  .skin-result {
    background:#FFF5FB;
    padding: 22px;
    border-radius: 18px;
    margin-top: 20px;
    display:none;
    animation: fadeIn 0.5s ease;
  }

  .skin-result strong { color:#FF90C2; font-size:1.2rem; }

  /* Info section */
  .skin-info {
    margin-top: 55px;
  }

  .skin-info h3 {
    color:#3BC7C4;
    font-size:1.7rem;
    text-align:center;
  }

  .skin-info-grid {
    display:grid;
    grid-template-columns: repeat(auto-fit,minmax(250px,1fr));
    gap:20px;
    margin-top:25px;
  }

  .info-card {
    background:white;
    padding:22px;
    border-radius:20px;
    box-shadow:0 8px 20px rgba(0,0,0,0.05);
    transition:.25s;
  }

  .info-card:hover { transform:scale(1.03); }

  .info-card h4 { margin:0; color:#FF90C2; font-size:1.2rem; }
  .info-card p { margin-top:8px; color:#555; }

  @keyframes fadeIn {
    from {opacity:0; transform:translateY(25px);}
    to {opacity:1; transform:translateY(0);}
  }

  @keyframes fadeUp {
    from {opacity:0; transform:translateY(20px);}
    to {opacity:1; transform:translateY(0);}
  }
</style>

<section class="skin-section">

  <h2 class="skin-title">‚ú® Skin Analysis Hub</h2>
  <p class="skin-sub">Learn how to protect your skin, understand your skin type, and get personalised feedback to stay healthy and safe in the sun.</p>

  <!-- INTRO CARDS -->
  <div class="skin-grid">
    <div class="skin-card">
      <h3>‚òÄÔ∏è UV Safety</h3>
      <p>UV rays can damage your skin even on cloudy days. Long-term exposure increases the risk of wrinkles, sunburn, and skin conditions. Protecting your skin early is key.</p>
    </div>

    <div class="skin-card">
      <h3>üß¥ Why Sunscreen?</h3>
      <p>Sunscreen blocks harmful UV rays and prevents long-term skin damage. Wearing SPF 30+ daily dramatically reduces the risk of sunburn and keeps your skin healthy.</p>
    </div>

    <div class="skin-card">
      <h3>üíß Skin Health Matters</h3>
      <p>Your skin is your largest organ ‚Äî it protects you from germs, heat, and environmental damage. Keeping it healthy boosts confidence and prevents future issues.</p>
    </div>
  </div>

  <!-- FORM -->
  <div class="skin-form">
    <h3>üìù Personal Skin Analysis</h3>

    <form id="skinForm">
      <div class="skin-field">
        <label>What is your skin type?</label>
        <select id="skinType">
          <option value="">Select...</option>
          <option>Dry</option>
          <option>Oily</option>
          <option>Combination</option>
          <option>Sensitive</option>
          <option>Normal</option>
        </select>
      </div>

      <div class="skin-field">
        <label>How often do you wear sunscreen?</label>
        <select id="sunscreen">
          <option value="">Select...</option>
          <option>Every day</option>
          <option>Sometimes</option>
          <option>Rarely</option>
          <option>Never</option>
        </select>
      </div>

      <div class="skin-field">
        <label>How easily do you burn in the sun?</label>
        <select id="burn">
          <option value="">Select...</option>
          <option>Very easily</option>
          <option>Sometimes</option>
          <option>Rarely</option>
          <option>Almost never</option>
        </select>
      </div>

      <div class="skin-field">
        <label>Any current skin concerns? (optional)</label>
        <input id="concern" type="text" placeholder="Dryness, redness, uneven tone...">
      </div>

      <button type="submit" class="skin-btn">Generate My Skin Feedback</button>
    </form>

    <div id="skinResult" class="skin-result"></div>
  </div>

  <!-- EDUCATION SECTION -->
  <div class="skin-info">
    <h3>üåø Learn More About Skin & Sun Safety</h3>

    <div class="skin-info-grid">
      <div class="info-card">
        <h4>SPF Explained</h4>
        <p>SPF measures how well sunscreen protects you from UVB rays. SPF 30 blocks about 97% of UVB rays.</p>
      </div>

      <div class="info-card">
        <h4>Cloudy Days Still Matter</h4>
        <p>Up to 80% of UV rays pass through clouds ‚Äî meaning your skin can get damaged even when it's grey outside.</p>
      </div>

      <div class="info-card">
        <h4>Skin Ageing</h4>
        <p>90% of early skin ageing is caused by sunlight. Daily protection keeps your skin youthful and healthy.</p>
      </div>

      <div class="info-card">
        <h4>Hydration</h4>
        <p>Moisturising helps protect your skin barrier, reduce irritation, and keep your skin glowing.</p>
      </div>
    </div>
  </div>

</section>

<script>
  document.getElementById("skinForm").addEventListener("submit", function(e){
    e.preventDefault();

    const type = document.getElementById("skinType").value;
    const sun = document.getElementById("sunscreen").value;
    const burn = document.getElementById("burn").value;
    const concern = document.getElementById("concern").value;

    let advice = "<strong>Your Personal Skin Feedback:</strong><br><br>";

    // Skin type
    if(type === "Dry") advice += "üå∏ Your skin needs hydration ‚Äî moisturisers are your best friend.<br>";
    if(type === "Oily") advice += "‚ú® Gentle cleansers and non-greasy SPF work best for your skin type.<br>";
    if(type === "Combination") advice += "üíß A balanced routine will help manage both oily & dry areas.<br>";
    if(type === "Sensitive") advice += "ü´∂ Choose fragrance-free products and always patch-test new items.<br>";
    if(type === "Normal") advice += "üåü Keep up your routine ‚Äî your skin is well balanced.<br>";

    // Sunscreen habits
    if(sun === "Every day") advice += "üß¥ Amazing! Daily SPF protects your skin long-term.<br>";
    if(sun === "Sometimes") advice += "‚òÄÔ∏è Try wearing sunscreen more consistently ‚Äî your skin will thank you.<br>";
    if(sun === "Rarely") advice += "‚ö†Ô∏è Sunscreen helps prevent skin damage ‚Äî start adding it to your routine.<br>";
    if(sun === "Never") advice += "üö® UV rays can damage skin even indoors ‚Äî wearing SPF daily is super important.<br>";

    // Burning level
    if(burn === "Very easily") advice += "üî• You should wear SPF every day ‚Äî your skin is extra sensitive to UV.<br>";
    if(burn === "Sometimes") advice += "‚òÄÔ∏è Take extra care on sunny days ‚Äî bring SPF with you.<br>";
    if(burn === "Rarely") advice += "üí™ You‚Äôre less prone to burning, but still need SPF daily.<br>";
    if(burn === "Almost never") advice += "üåû Even if you don't burn, UV rays still cause damage ‚Äî SPF is essential.<br>";

    if(concern.length > 0){
      advice += `<br>üí¨ You mentioned: <strong>${concern}</strong><br>Consider using gentle products to support your skin barrier.`;
    }

    document.getElementById("skinResult").innerHTML = advice;
    document.getElementById("skinResult").style.display = "block";
  });
</script> 



<!-- ‚≠ê ALL EXTRA SKIN FEATURES ‚Äì SAFE, NON-MEDICAL, USER-FRIENDLY -->
<style>
  .skin-extra-section {
    margin-top: 60px;
    padding: 30px;
    background: #FFF9FD;
    border-radius: 25px;
    animation: fadeIn 0.8s ease;
  }

  .skin-extra-title {
    text-align: center;
    font-size: 2rem;
    font-weight: 800;
    color: #FF90C2;
  }

  .skin-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(260px,1fr));
    gap: 22px;
    margin-top: 30px;
  }

  .skin-card {
    background: white;
    border-radius: 22px;
    padding: 22px;
    box-shadow: 0 6px 20px rgba(0,0,0,0.06);
    transition: .25s ease;
  }

  .skin-card:hover { transform: scale(1.03); }

  .skin-card h3 {
    color: #3BC7C4;
    font-size: 1.3rem;
    font-weight: 700;
    margin: 0;
  }

  .skin-btn {
    margin-top: 12px;
    padding: 10px 16px;
    background: linear-gradient(90deg,#FF90C2,#3BC7C4);
    border-radius: 14px;
    color: white;
    border: none;
    font-weight: 700;
    cursor: pointer;
  }

  .skin-output {
    margin-top: 15px;
    padding: 15px;
    background: #FFF0F7;
    border-radius: 18px;
    display: none;
  }

  /* Carousel */
  .carousel {
    width: 100%;
    overflow-x: auto;
    display: flex;
    gap: 16px;
    scroll-snap-type: x mandatory;
    padding-bottom: 10px;
  }

  .carousel-card {
    min-width: 260px;
    background: white;
    padding: 20px;
    border-radius: 22px;
    box-shadow: 0 4px 14px rgba(0,0,0,0.07);
    scroll-snap-align: start;
  }

  .progress-bar {
    height: 14px;
    background: #FFEBAF;
    border-radius: 10px;
    margin-top: 10px;
    overflow: hidden;
  }
  .progress-fill {
    height: 100%;
    width: 0%;
    background: #3BC7C4;
    border-radius: 10px;
    transition: width 0.4s ease;
  }

</style>

<!-- =========================
  Camera-Based Skin Analyzer
  - Local (client-side) analysis
  - Privacy-first: no uploads unless user consents
  - Non-medical, educational only
  - Theme colours: #FF90C2 #92F2D7 #3BC7C4 #FFEBAF
========================= -->
<section id="camera-skin-analysis" style="font-family: Poppins, system-ui, Arial; padding:24px; max-width:980px; margin:18px auto;">

  <style>
    :root{
      --pink:#FF90C2; --mint:#92F2D7; --turq:#3BC7C4; --yellow:#FFEBAF;
      --muted:#5a6063; --card-radius:16px; --shadow:0 8px 30px rgba(12,30,40,0.06);
    }
    .cam-card { background:linear-gradient(180deg,#fff,#fbfbfb); border-radius:var(--card-radius); padding:18px; box-shadow:var(--shadow); }
    h3{ margin:0 0 8px 0; color:var(--pink); font-weight:800; font-size:20px; }
    p.lead{ margin:0 0 12px 0; color:var(--muted); font-size:14px; }
    .row{ display:flex; gap:12px; align-items:flex-start; flex-wrap:wrap; }
    .col{ flex:1; min-width:260px; }
    .video-box{ background:#eefaf7; border-radius:12px; padding:8px; display:flex; justify-content:center; align-items:center; }
    video{ border-radius:10px; max-width:100%; width:320px; height:auto; }
    canvas{ display:none; }
    .btn { background: linear-gradient(90deg,var(--turq),var(--mint)); color:white; border:none; padding:10px 14px; border-radius:12px; font-weight:700; cursor:pointer; }
    .btn.alt { background:transparent; border:1px solid #e6eef0; color:var(--muted); }
    .muted{ color:var(--muted); font-size:13px; }
    .results-box{ margin-top:12px; border-radius:12px; padding:12px; background:linear-gradient(180deg,#fff,#f7fffb); box-shadow:var(--shadow); }
    .metric{ display:flex; justify-content:space-between; margin:8px 0; align-items:center; }
    .metric strong { color:var(--turq); }
    .bar-wrap{ background:#FFEBAF; height:12px; border-radius:10px; overflow:hidden; width:100%; margin-left:12px; }
    .bar-fill{ height:100%; background:linear-gradient(90deg,var(--pink),var(--turq)); width:0%; transition:width .5s ease; }
    .privacy { font-size:13px; color:#444; margin-top:10px; }
    label.consent { display:flex; gap:8px; align-items:center; cursor:pointer; margin-top:12px; }
    .small { font-size:12px; color:var(--muted); }
    .tips { margin-top:12px; padding:12px; background:#FFF8F9; border-radius:10px; }
    .img-preview { width:120px; height:120px; border-radius:10px; object-fit:cover; border:2px solid #f0f0f0; }
  </style>

  <div class="cam-card">
    <h3>Camera Skin Analyzer</h3>
    <p class="lead">Take a quick photo of a clear patch of skin (cheek/forehead) and get friendly, non-medical feedback about redness, brightness and simple care tips. Images stay on your device unless you choose to upload them.</p>

    <div class="row">

      <!-- Left: camera -->
      <div class="col">
        <div class="video-box" id="videoWrap">
          <video id="skinVideo" autoplay playsinline></video>
        </div>

        <div style="margin-top:8px; display:flex; gap:8px; flex-wrap:wrap;">
          <button class="btn" id="captureBtn">üì∏ Capture</button>
          <button class="btn alt" id="switchBtn" title="Switch camera (if available)">üîÅ Switch</button>
          <button class="btn alt" id="uploadBtn" title="Load photo from files">üìÅ Upload</button>
        </div>

        <input id="fileInput" type="file" accept="image/*" style="display:none">

        <div class="muted" style="margin-top:8px;">Tip: Hold camera steady and frame a clean patch of skin with natural light. Avoid heavy makeup for best analysis.</div>
      </div>

      <!-- Right: results + controls -->
      <div class="col" style="min-width:320px;">

        <div class="results-box" id="resultsBox" aria-live="polite">
          <div style="display:flex; gap:12px; align-items:center;">
            <img id="previewImg" class="img-preview" src="" alt="" style="display:none"/>
            <div style="flex:1;">
              <div class="muted small">Last analysis</div>
              <div id="summaryText" style="font-weight:700; margin-top:6px">No photo yet</div>
            </div>
          </div>

          <div style="margin-top:12px;">
            <div class="metric"><span>Redness</span><strong id="rednessVal">‚Äî</strong></div>
            <div class="bar-wrap"><div class="bar-fill" id="redBar"></div></div>

            <div class="metric"><span>Brightness</span><strong id="brightVal">‚Äî</strong></div>
            <div class="bar-wrap"><div class="bar-fill" id="brightBar"></div></div>

            <div class="metric"><span>Texture (proxy)</span><strong id="texVal">‚Äî</strong></div>
            <div class="bar-wrap"><div class="bar-fill" id="texBar"></div></div>
          </div>

          <div class="tips" id="adviceBox" style="display:none; margin-top:12px;"></div>

          <div style="margin-top:10px;">
            <label class="consent"><input type="checkbox" id="consentUpload"><span class="small">I consent to upload this image to my server (optional)</span></label>
            <div style="display:flex; gap:8px; margin-top:8px;">
              <button class="btn" id="uploadServerBtn" disabled>‚¨Ü Upload (consent required)</button>
              <button class="btn alt" id="saveLocalBtn">üíæ Save locally</button>
            </div>
            <div class="small muted" style="margin-top:8px;">Privacy: images remain local unless you explicitly consent and tap Upload. Don't share photos you don't want stored.</div>
          </div>
        </div>

      </div>
    </div>
  </div>

  <!-- hidden canvas for analysis -->
  <canvas id="analysisCanvas"></canvas>

  <!-- EXPLAINER (non-medical) -->
  <div style="margin-top:12px; font-size:13px; color:var(--muted)">
    <strong>About this tool:</strong> This feature uses basic pixel analysis to detect red tones, average brightness, and a simple texture proxy ‚Äî it is educational only and not a medical diagnosis. For persistent redness, sudden changes, painful symptoms, or concerns, please consult a doctor or dermatologist.
  </div>
</section>

<script>
/* Camera Skin Analyzer JS - client-side only by default */

/* DOM elements */
const video = document.getElementById('skinVideo');
const captureBtn = document.getElementById('captureBtn');
const switchBtn = document.getElementById('switchBtn');
const uploadBtn = document.getElementById('uploadBtn');
const fileInput = document.getElementById('fileInput');
const canvas = document.getElementById('analysisCanvas');
const previewImg = document.getElementById('previewImg');
const summaryText = document.getElementById('summaryText');
const adviceBox = document.getElementById('adviceBox');
const rednessVal = document.getElementById('rednessVal');
const brightVal = document.getElementById('brightVal');
const texVal = document.getElementById('texVal');
const redBar = document.getElementById('redBar');
const brightBar = document.getElementById('brightBar');
const texBar = document.getElementById('texBar');
const consentUpload = document.getElementById('consentUpload');
const uploadServerBtn = document.getElementById('uploadServerBtn');
const saveLocalBtn = document.getElementById('saveLocalBtn');

let currentStream = null;
let usingDeviceId = null;
let videoDevices = [];
let lastImageDataURL = null;

/* Utilities */
function clamp(v, a=0, b=100){ return Math.max(a, Math.min(b, v)); }
function pctToBar(el, v){ el.style.width = clamp(v,0,100) + '%'; }

/* Start camera (try environment/back camera first) */
async function startCamera(deviceId = null){
  stopCamera();
  try {
    const constraints = { video: { facingMode: "environment", width: { ideal: 1280 }, height: { ideal: 720 } } };
    if (deviceId) constraints.video.deviceId = { exact: deviceId };
    currentStream = await navigator.mediaDevices.getUserMedia(constraints);
    video.srcObject = currentStream;
    // build device list if empty
    if (!videoDevices.length) {
      const devices = await navigator.mediaDevices.enumerateDevices();
      videoDevices = devices.filter(d => d.kind === 'videoinput');
      // choose index 0 as default if not set
      if (videoDevices.length && !usingDeviceId) usingDeviceId = videoDevices[0].deviceId;
    }
  } catch (err) {
    console.warn('Camera start failed:', err);
    summaryText.textContent = 'Camera not available. You can upload an image instead.';
  }
}

function stopCamera(){
  if (currentStream) {
    currentStream.getTracks().forEach(t => t.stop());
    currentStream = null;
  }
}

/* Switch camera if multiple */
async function switchCamera(){
  if (videoDevices.length < 2) {
    // try to refresh
    const devices = await navigator.mediaDevices.enumerateDevices();
    videoDevices = devices.filter(d => d.kind === 'videoinput');
  }
  if (videoDevices.length < 2) {
    alert('No second camera found.');
    return;
  }
  // pick next
  const idx = videoDevices.findIndex(d => d.deviceId === usingDeviceId);
  const next = videoDevices[(idx + 1) % videoDevices.length];
  usingDeviceId = next.deviceId;
  await startCamera(usingDeviceId);
}

/* Capture a frame from video and analyze */
function captureFromVideo(){
  if (!video.srcObject) {
    alert('Camera not started or permission denied. Please upload a photo instead.');
    return;
  }
  const w = video.videoWidth;
  const h = video.videoHeight;
  canvas.width = w;
  canvas.height = h;
  const ctx = canvas.getContext('2d');
  ctx.drawImage(video, 0, 0, w, h);
  const dataURL = canvas.toDataURL('image/jpeg', 0.85);
  lastImageDataURL = dataURL;
  analyzeImageFromDataURL(dataURL);
}

/* Handle uploaded file */
fileInput.addEventListener('change', (ev) => {
  const f = ev.target.files[0];
  if (!f) return;
  const reader = new FileReader();
  reader.onload = e => {
    lastImageDataURL = e.target.result;
    analyzeImageFromDataURL(lastImageDataURL);
  };
  reader.readAsDataURL(f);
});

/* Public UI triggers */
captureBtn.addEventListener('click', captureFromVideo);
switchBtn.addEventListener('click', switchCamera);
uploadBtn.addEventListener('click', () => fileInput.click());

/* Analyze dataURL: do pixel-level heuristics */
function analyzeImageFromDataURL(dataURL){
  // show preview
  previewImg.src = dataURL;
  previewImg.style.display = 'block';
  summaryText.textContent = 'Analyzing...';
  adviceBox.style.display = 'none';

  // draw to canvas scaled down for performance
  const img = new Image();
  img.onload = () => {
    const max = 600; // scale to max dimension for analysis
    let w = img.width, h = img.height;
    const scale = Math.min(1, max / Math.max(w,h));
    w = Math.round(w * scale);
    h = Math.round(h * scale);
    canvas.width = w; canvas.height = h;
    const ctx = canvas.getContext('2d');
    ctx.drawImage(img, 0, 0, w, h);
    const im = ctx.getImageData(0,0,w,h);
    const data = im.data;

    // metrics
    let rSum=0, gSum=0, bSum=0, lumSum=0;
    let rednessPixels = 0;
    // texture proxy: use local variance across pixels
    let textureSum = 0;
    // sample stride to make fast (every 3rd pixel)
    const stride = 4 * 3;
    const width = w;
    for (let i=0; i<data.length; i += stride) {
      const r = data[i], g = data[i+1], b = data[i+2];
      rSum += r; gSum += g; bSum += b;
      const lum = 0.2126*r + 0.7152*g + 0.0722*b;
      lumSum += lum;
      // redness heuristic: r notably higher than g and b
      if (r > g + 18 && r > b + 18 && r > 90) rednessPixels++;
      // texture: difference to neighboring pixel (approx)
      // compute simple gradient if within bounds
      const idx = i/4;
      const x = idx % width;
      const y = Math.floor(idx / width);
      if (x < width - 1) {
        const ni = i + 4;
        const nr = data[ni], ng = data[ni+1], nb = data[ni+2];
        const d = Math.abs(r - nr) + Math.abs(g - ng) + Math.abs(b - nb);
        textureSum += d;
      }
    }
    const count = Math.floor(data.length / stride);
    const avgR = rSum / count;
    const avgG = gSum / count;
    const avgB = bSum / count;
    const avgLum = lumSum / count;
    const rednessPct = Math.round((rednessPixels / count) * 1000) / 10; // percent-ish
    const textureScore = Math.round((textureSum / count) / 10); // scaled proxy

    // map to 0-100 for bars
    const redScore = clamp(Math.round(rednessPct * 1.6), 0, 100); // scaled
    const brightScore = clamp(Math.round((avgLum / 255) * 100), 0, 100);
    const texScore = clamp(textureScore, 0, 100);

    // update UI
    rednessVal.textContent = redScore + '%';
    brightVal.textContent = brightScore + '%';
    texVal.textContent = texScore + '%';
    pctToBar(redBar, redScore);
    pctToBar(brightBar, brightScore);
    pctToBar(texBar, texScore);

    // friendly summary & tips
    const tips = [];
    if (redScore > 30) {
      tips.push('Noticeable redness detected ‚Äî try gentle, fragrance-free skincare and reduce harsh exfoliation. If irritation persists, see a doctor.');
    } else if (redScore > 12) {
      tips.push('Mild redness present ‚Äî consider a calming routine (aloe, fragrance-free moisturizer) and sun protection.');
    } else {
      tips.push('No significant redness detected ‚Äî skin looks calm in this photo.');
    }

    if (brightScore < 40) tips.push('Photo looks darker ‚Äî skin may benefit from hydration and gentle exfoliation (if appropriate).');
    if (brightScore > 80) tips.push('Bright photo ‚Äî good lighting; remember to use SPF if outdoors.');

    if (texScore > 40) tips.push('Higher texture detected ‚Äî keeping a gentle exfoliation schedule and moisturising can help, and see a professional if rough patches persist.');

    // final summary
    summaryText.textContent = 'Analysis complete';
    adviceBox.innerHTML = tips.map(t => `‚Ä¢ ${t}`).join('<br>');
    adviceBox.style.display = 'block';

    // store last image in memory (optional localStorage thumbnail)
    try { localStorage.setItem('skin_last_image', dataURL); } catch(e){ /* ignore */ }

  };
  img.onerror = () => {
    summaryText.textContent = 'Could not analyze image. Try a different photo.';
  };
  img.src = dataURL;
}

/* Save locally (download) */
saveLocalBtn.addEventListener('click', ()=>{
  if (!lastImageDataURL) { alert('No image to save yet. Capture or upload a photo first.'); return; }
  const a = document.createElement('a');
  a.href = lastImageDataURL;
  a.download = 'skin_snapshot.png';
  document.body.appendChild(a); a.click(); a.remove();
});

/* Upload to server (explicit consent required)
   - By default this is disabled unless user ticks consent.
   - Server should implement POST /analyze-image to accept JSON { image: dataURL, meta: {...} }
   - If you want the exact fetch code for your FastAPI endpoint, uncomment and adapt below.
*/
consentUpload.addEventListener('change', (e)=>{
  uploadServerBtn.disabled = !consentUpload.checked;
});
uploadServerBtn.addEventListener('click', async ()=>{
  if (!consentUpload.checked) { alert('Please check consent box before uploading.'); return; }
  if (!lastImageDataURL) { alert('No image to upload.'); return; }

  // Example fetch ‚Äî adapt endpoint URL and payload to your backend.
  // --- Begin optional upload (uncomment to enable) ---
  /*
  try {
    const resp = await fetch('http://127.0.0.1:8000/analyze-skin-image', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        image: lastImageDataURL,
        meta: { timestamp: Date.now(), note: 'user-consented' }
      })
    });
    if (resp.ok) {
      const json = await resp.json();
      alert('Server analysis: ' + (json.feedback || 'Done'));
    } else {
      alert('Upload failed: ' + resp.status);
    }
  } catch (err) {
    alert('Upload error: ' + err.message);
  }
  */
  // --- End optional upload ---
  alert('Upload is disabled in this demo. To enable, uncomment the fetch() block in the code and point it to your backend endpoint.');
});

/* start camera on load */
(async function init(){
  if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
    summaryText.textContent = 'No camera support in this browser ‚Äî use the Upload button.';
    return;
  }
  try {
    await startCamera();
  } catch(e){ console.warn(e); }
})();

/* cleanup when leaving page */
window.addEventListener('beforeunload', ()=> stopCamera());

</script> 


<section class="uv-section">
  <h1>‚òÄÔ∏è Ultraviolet (UV) Light: Risks & Prevention</h1>

  <p class="intro">
    Ultraviolet (UV) light comes from the sun and artificial sources such as UV lamps.
    Excessive exposure can cause harm to human health and the environment.
  </p>

  <div class="grid">

    <div class="card skin collapsible">
      <button class="toggle"> Effects on Skin</button>
      <div class="content">
        <img src="Screenshot_20260103-203905.png" alt="Skin">
        <ul>
          <li>Sunburn and irritation</li>
          <li>Premature aging</li>
          <li>DNA damage to skin cells</li>
          <li>Increased skin cancer risk</li>
        </ul>
      </div>
    </div>

    <div class="card eyes collapsible">
      <button class="toggle"> Effects on Eyes</button>
      <div class="content">
        <img src="https://images.unsplash.com/photo-1516575334481-f85287c2c82d" alt="Human eye close up">
        <ul>
          <li>Eye irritation and strain</li>
          <li>Photokeratitis (UV eye burn)</li>
          <li>Cataracts over time</li>
          <li>Retinal damage</li>
          <li>Eye Cancer</li>
        </ul>
      </div>
    </div>

    <div class="card body collapsible">
      <button class="toggle"> Effects on the Human Body</button>
      <div class="content">
        <img src="Screenshot_20260103-204351.png"alt="Effects on the Human Body"
        <ul>
          <li>Weakened immune system</li>
          <li>Cell mutations</li>
          <li>Long-term health risks</li>
        </ul>
      </div>
    </div>

    <div class="card environment collapsible">
      <button class="toggle"> Environmental Effects</button>
      <div class="content">
        <img src="https://images.unsplash.com/photo-1500534314209-a25ddb2bd429" alt="Environmental impact">
        <ul>
          <li>Plant and crop damage</li>
          <li>Marine ecosystem disruption</li>
          <li>Food chain imbalance</li>
          <li>Ozone depletion effects</li>
        </ul>
      </div>
    </div>

  </div>

  <div class="prevention collapsible">
    <button class="toggle">Prevention & Safety Tips</button>
    <div class="content">
      <ul>
        <li>Apply SPF 30+ sunscreen - reef safe</li>
        <li>Wear UV-protective sunglasses</li>
        <li>Cover skin with hats and clothing</li>
        <li>Avoid sun from 12am‚Äì4pm</li>
        <li>Limit artificial UV exposure</li>
      </ul>
    </div>
  </div>
</section>

<style>
  .uv-section {
    font-family: Arial, sans-serif;
    padding: 40px;
    background: linear-gradient(135deg, #fff1eb, #ace0f9);
    border-radius: 20px;
    max-width: 1200px;
    margin: 40px auto;
  }

  h1 {
    text-align: center;
    font-size: 2.4rem;
    color: #6d597a;
  }

  .intro {
    text-align: center;
    margin-bottom: 30px;
    color: #4a4a4a;
  }

  .grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
    gap: 20px;
  }

  .card {
    border-radius: 18px;
    overflow: hidden;
    box-shadow: 0 6px 14px rgba(0,0,0,0.15);
  }

  .toggle {
    width: 100%;
    background: transparent;
    border: none;
    font-size: 1.15rem;
    font-weight: bold;
    padding: 18px;
    cursor: pointer;
    text-align: left;
  }

  .content {
    padding: 20px;
  }

  .content img {
    width: 100%;
    height: 160px;
    object-fit: cover;
    border-radius: 12px;
    margin-bottom: 15px;
  }

  /*  Pastel Card Colors */
  .skin {
    background: linear-gradient(135deg, #fbc2eb, #a6c1ee);
    color: #3d2c41;
  }

  .eyes {
    background: linear-gradient(135deg, #cfd9df, #e2ebf0);
    color: #2f3e46;
  }

  .body {
    background: linear-gradient(135deg, #d4fc79, #96e6a1);
    color: #2f4f4f;
  }

  .environment {
    background: linear-gradient(135deg, #b7f8db, #50a7c2);
    color: #1f3d3a;
  }

  .prevention {
    margin-top: 30px;
    background: #fff7e6;
    border-radius: 18px;
    color: #5a4a42;
    box-shadow: 0 4px 10px rgba(0,0,0,0.1);
  }

  /* Mobile collapse */
  @media (max-width: 768px) {
    .content {
      display: none;
    }

    .collapsible.active .content {
      display: block;
    }
  }
</style>

<script>
  document.querySelectorAll(".toggle").forEach(button => {
    button.addEventListener("click", () => {
      button.parentElement.classList.toggle("active");
    });
  });
</script> 
